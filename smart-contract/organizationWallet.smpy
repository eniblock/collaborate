import smartpy as sp

organization_value_type = sp.TRecord(
    roles = sp.TSet(sp.TNat),  # organization role (1: DSP, 2: BSP)
    legal_name = sp.TString,
    address = sp.TAddress,
    encryption_key = sp.TString, # TODO this can be off-chain
)

organizations_type = sp.TMap(
    sp.TAddress,
    organization_value_type
)

class OrganizationWalletManagement(sp.Contract):
    def __init__(self, _org: organizations_type, metadata):
        self.init(
            organizations = _org,
            metadata = metadata
        )

if "templates" not in __name__:
    @sp.add_test(name = "OrganizationWalletManagement")
    def test():
        scenario = sp.test_scenario()

        orga_DSPConsortium1 = sp.record(
            legal_name = 'DSPConsortium1',
            address = sp.address('tz1WpmFuSZfuNS7XDKwDZxX3QhSNUneTkiTv'),
            encryption_key = 'MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAzEi+JDOxh+ENuGfl7hpGlRp/iSwG7L2Z1pRhfTt4vDAqi/bN2T/BhjzMhYZrYLQXi3CvYC3WOGqKj94Hi3SgYqkEZ1c1MihE4+7bN+DrCR11YItCVPL2Oac99mO/3MqxMajH/mfJAIZcy8P5Ey6hFLnGbdtW6vXXc25BLhoJoWLxgkh5I/DvBK4p0zfwqRUokEsy5Fcndy81DZUcGnqIhaL7Y48Sdhe9K3tEdZWoQAVZIgloZAxfaFIryYOqOS6kJxzItQRDesl7nIGnQUWoW0Qwh3q+GAMeYllxzITMf+Ti++kQOVVVZvyoJO+dRMncOqL496SmFGcp5jpKZkNh6wIDAQAB',
            roles = {1}
        )
        orga_BSPConsortium2 = sp.record(
            legal_name = 'BSPConsortium2',
            address = sp.address('tz1XDwkYzcxqswBhQDd1QxiBrA53J5bZzHg2'),
            encryption_key = 'MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAsCSS6ayF41KEOOxaTVdnO5SulP7EnFFxjs6E7i8HSDxYgoLQTlqPycvp86dcfRwLPtySP1EHHtTKEsQmPnaWA7npBEwkTmg9VkFseetmph6h2GiaCcxhOpRnpYEfCtjlF89OPVZPU3lvIeQCZhud/YaGk/4+8I1ZRHgEwhJXXc3MFr9V71k8jGxj/Sbmy0v5ATzzMmCchi1MGvH9acZy2UUSczO8O7burs5SrRpxY9JmAV/tFy1cnYwsPrs25XklI/x6KS/fZneybEJZ0QHNQLUEkKgqZOeNc7aK8TWX2ZTvjMnCfp1zhR2sFtXNMSja/fA9H/1UcR8j3cu4qaI1ewIDAQAB',
            roles = {2}
        )
        organizations = sp.map(
            {
                orga_DSPConsortium1.address: orga_DSPConsortium1,
                orga_BSPConsortium2.address: orga_BSPConsortium2
            }
        )

        scMetadata = sp.utils.metadata_of_url("https://example.com")

        c1 = OrganizationWalletManagement(organizations, scMetadata)

        scenario += c1
