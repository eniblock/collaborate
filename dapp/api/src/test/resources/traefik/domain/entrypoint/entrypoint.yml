---
http:
  routers:
    "1-vehicles-router":
      entryPoints:
        - "websecure"
      rule: "PathPrefix(`/datasource/1/vehicles`)"
      service: "1"
      middlewares:
        - "1-auth-headers"
        - "1-vehicles-query-params"
        - "1-vehicles-replace-path-regex"
        - "1-vehicles-strip-prefix"
      tls: true
    "1-kilometer-router":
      entryPoints:
        - "websecure"
      rule: "PathPrefix(`/datasource/1/kilometer`)"
      service: "1"
      middlewares:
        - "1-auth-headers"
        - "1-kilometer-query-params"
        - "1-kilometer-replace-path-regex"
        - "1-kilometer-strip-prefix"
      tls: true
    "1-maintenance-router":
      entryPoints:
        - "websecure"
      rule: "PathPrefix(`/datasource/1/maintenance`)"
      service: "1"
      middlewares:
        - "1-auth-headers"
        - "1-maintenance-query-params"
        - "1-maintenance-replace-path-regex"
        - "1-maintenance-strip-prefix"
      tls: true
  services:
    "1":
      loadBalancer:
        servers:
          - url: "https://api-cert-preprod.groupe-psa.com"
        passHostHeader: false
        serversTransport: "1-serversTransport"
  middlewares:
    "1-kilometer-strip-prefix":
      stripPrefix:
        prefixes:
          - "/datasource/1/kilometer"
    "1-maintenance-strip-prefix":
      stripPrefix:
        prefixes:
          - "/datasource/1/maintenance"
    "1-vehicles-strip-prefix":
      stripPrefix:
        prefixes:
          - "/datasource/1/vehicles"
    "1-auth-headers":
      headers:
        customRequestHeaders:
          Authorization: "Basic TVdQRFJWMDE6QkJybEtRMGk="
    "1-vehicles-query-params":
      redirectRegex:
        regex: "/([^\\?\\s]*)(\\??)(.*)"
        replacement: "/${1}?client_id=c8fc43d5-f43f-44e5-acc2-b8aebaee90e2"
    "1-kilometer-query-params":
      redirectRegex:
        regex: "/([^\\?\\s]*)(\\??)(.*)"
        replacement: "/${1}?client_id=c8fc43d5-f43f-44e5-acc2-b8aebaee90e2&profile=fleet&extension=odometer"
    "1-maintenance-query-params":
      redirectRegex:
        regex: "/([^\\?\\s]*)(\\??)(.*)"
        replacement: "/${1}?client_id=c8fc43d5-f43f-44e5-acc2-b8aebaee90e2"
    "1-vehicles-replace-path-regex":
      replacePathRegex:
        regex: "/datasource/1/vehicles"
        replacement: "/datasource/1/vehicles/connectedcar/v3/fleets/5fb2830db35c87031c2e0d68/vehicles"
    "1-maintenance-replace-path-regex":
      replacePathRegex:
        regex: "/datasource/1/maintenance/(.*)/(.*)"
        replacement: "/datasource/1/maintenance/connectedcar/v3/fleets/5fb2830db35c87031c2e0d68/vehicles/$1/maintenance/$2"
    "1-kilometer-replace-path-regex":
      replacePathRegex:
        regex: "/datasource/1/kilometer/(.*)"
        replacement: "/datasource/1/kilometer/connectedcar/v3/fleets/5fb2830db35c87031c2e0d68/vehicles/$1/status"
  serversTransports:
    "1-serversTransport":
      certificates:
        - certFile: "/ssl/certs/1.cer"
          keyFile: "/ssl/certs/1.pem"
      insecureSkipVerify: false
